var upcal=upcal||{};if(!upcal.init){upcal.init=function(c,b,d){var a=new Array();upcal.CalendarDay=d.Model.extend({defaults:function(){return{code:null,displayName:null,events:new upcal.CalendarEventList()};}});upcal.CalendarEvent=d.Model.extend({defaults:function(){return{summary:null,description:null,location:null,startTime:null,endTime:null,dateStartTime:null,dateEndTime:null,startDate:null,endDate:null,allDay:false,multiDay:false,colorIndex:0};}});upcal.CalendarError=d.Model.extend({defaults:function(){return{};}});upcal.CalendarDayList=d.Collection.extend({model:upcal.CalendarDay});upcal.CalendarEventList=d.Collection.extend({model:upcal.CalendarEvent});upcal.CalendarErrorList=d.Collection.extend({model:upcal.CalendarError});upcal.EventListView=d.View.extend({el:".upcal-event-view",postRender:function(){},render:function(){this.$(".upcal-event-list").html(this.template({days:this.model.toJSON()}));var e=this;e.$(".upcal-event-list a").click(function(){var k,f;k=c(this);var j=c(k.parents("div.day").get(0));var h=e.$(".day").index(j);var l=c(k.parents("div.upcal-event").get(0));var g=c(j).find(".upcal-event").index(l);var i=e.model.at(h).get("events").at(g);e.trigger("eventSelected",i);});this.postRender();return this;}});upcal.EventDetailView=d.View.extend({el:".upcal-event-details",postRender:function(){},render:function(){this.$(".upcal-event-detail").html(this.template({event:this.model.toJSON()}));var e=this;this.$(".titlebar a").click(function(){e.trigger("showList");});this.postRender();return this;}});upcal.CalendarParameterView=d.View.extend({render:function(){this.$el.append(this.template(this.model));}});upcal.CalendarView=d.Model.extend({defaults:function(){return{container:null,detailView:new upcal.EventDetailView(),listView:new upcal.EventListView(),eventsUrl:null,startDate:null,days:7};},initialize:function(){var e=this;c(e.get("container")).find(".upcal-inline-calendar").datepicker({inline:true,changeMonth:false,changeYear:false,defaultDate:this.get("startDate"),onSelect:function(f){e.set("startDate",f);e.getEvents(e.get("startDate"),e.get("days"));}});this.get("listView").bind("eventSelected",function(f){e.get("listView").$el.hide();e.get("detailView").$el.show();e.get("detailView").model=f;e.get("detailView").render();});this.get("detailView").$(".upcal-view-return").click(function(){e.get("listView").$el.show();e.get("detailView").$el.hide();});return this;},getEvents:function(f,j){var g,i;g=this;i=g.get("listView");i.$(".upcal-loading-message").show();i.$(".upcal-event-list").hide();var k=i.$(".upcal-event-errors");k.hide();k.empty();var l=g.get("startDate").replace(/\//g,"");var m=g.get("days");var h=(a[l]&&a[l][m])?"false":"true";var e=g.get("eventsUrl").replace(/START/,l).replace(/DAYS/,m).replace(/REFRESH/,h);c.ajax({url:e,success:function(r){var s=new upcal.CalendarDayList();var o,n,p;if(r&&r.errors&&r.errors.length>0){c(r.errors).each(function(t,u){var v=c("<p></p>");v.text(u);k.append(v);});k.show();}if(r&&r.dateMap&&r.dateNames){n=r.dateMap;p=r.dateNames;}else{var q=a[l]&&a[l][m];n=q&&q.dateMap;p=q&&q.dateNames;}if(n&&p){c.each(n,function(t,u){o=new upcal.CalendarDay({code:t,displayName:p[t]});c(u).each(function(v,w){var x=w.event;x.colorIndex=w.colorIndex;o.get("events").add(new upcal.CalendarEvent(x));});s.add(o);});}i.model=s;i.render();i.$(".upcal-loading-message").hide();i.$(".upcal-event-list").show();}});}});};}